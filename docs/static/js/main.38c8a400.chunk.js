(window["webpackJsonpcumvad.eu"]=window["webpackJsonpcumvad.eu"]||[]).push([[0],{103:function(e,t,n){"use strict";n.r(t);var a,r,i=n(0),o=n.n(i),c=n(24),l=n.n(c),s=(n(88),n(89),n(76)),u=n(27),f=n(121),h=n(126),g=n(29),m=n(122),p=n(130),d=n(133),b=n(123),v=n(129),w=n(124),O=n(30),y=n(47),E=n(60),j=n(61),x=n(36),k=(n(90),n(10));!function(e){e.TestQuestion="test-q",e.Blur="blur",e.ChromaticAberration="chroma-aberration",e.DoubleVision="DoubleVision"}(a||(a={})),function(e){e.yes="yes",e.no="no"}(r||(r={}));var C=n(127),D=n(104),P=n(131),S={question:{string:"Blurred vision?",id:a.Blur},answers:[{string:"no",id:r.no},{string:"yes",id:r.yes,extraComponent:function(e){var t=e.extraData,n=e.setExtraData,a=t?t.intensity:0;return o.a.createElement(C.a,null,o.a.createElement(D.a,null," Blur intensity "),o.a.createElement(P.a,{min:0,max:5,value:a,step:.1,onChange:function(e,t){return n({intensity:t})}}))}}],selected:{id:r.no},effect:function(e,t,n){var a=t.id,i=t.extraData,o=n.original;if(a!==r.no){var c=e.canvas,l=i&&i.intensity||0;e.filter="blur(".concat(l,"px)"),e.drawImage(o,0,0,o.width,o.height,0,0,c.width,c.height),e.filter="none"}}},I=n(48),A=n.n(I),q=n(42),M=n.n(q),N=n(66),B=n.n(N),R=n(65),L=n.n(R),z=[{value:0,label:o.a.createElement(A.a,null)},{value:Math.PI/2,label:o.a.createElement(L.a,null)},{value:Math.PI,label:o.a.createElement(M.a,null)},{value:3*Math.PI/2,label:o.a.createElement(B.a,null)},{value:2*Math.PI,label:o.a.createElement(A.a,null)}];function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(n,!0).forEach(function(t){Object(O.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(n,!0).forEach(function(t){Object(O.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var T=[S,{question:{string:"Color separation?",id:a.ChromaticAberration},answers:[{string:"no",id:r.no},{string:"yes",id:r.yes,extraComponent:function(e){var t=e.extraData,n=e.setExtraData,a=t?t.intensity:0,r=t?t.phase:0,i=t?t.angle:0;return o.a.createElement(C.a,null,o.a.createElement(D.a,null," Separation intensity "),o.a.createElement(P.a,{min:0,max:15,value:a,step:1,onChange:function(e,a){return n(F({},t,{intensity:a}))}}),o.a.createElement(D.a,null," Angle "),o.a.createElement(P.a,{min:0,max:2*Math.PI,value:i,step:.01,marks:z,onChange:function(e,a){return n(F({},t,{angle:a}))}}),o.a.createElement(D.a,null," Color Separation Type "),o.a.createElement(P.a,{min:0,max:2,value:r,step:1,onChange:function(e,a){return n(F({},t,{phase:a}))}}))}}],selected:{id:r.no},effect:function(e,t){var n=t.id,a=t.extraData;if(n!==r.no){var i=Math.floor(a&&a.phase||0),o=a&&a.angle||0,c=Math.floor(a&&a.intensity||0),l=e.canvas;console.time("get");var s=e.getImageData(0,0,l.width,l.height),u=s.data,f=u.slice();console.timeEnd("get");var h=Math.floor(Math.sin(o)*c),g=Math.floor(Math.cos(o)*c);console.log(Math.sin(o),Math.cos(o)),console.log(h,g);var m=u.length;console.time("js");for(var p=i,d=p+4*h+4*l.width*g;p<m&&d<m;p+=4,d+=4)p>0&&d>0&&p<m&&d<m&&(u[p]=f[d]);console.timeEnd("js"),console.time("put"),e.putImageData(s,0,0),console.timeEnd("put")}}},{question:{string:"Double vision?",id:a.DoubleVision},answers:[{string:"no",id:r.no},{string:"yes",id:r.yes,extraComponent:function(e){var t=e.extraData,n=e.setExtraData,a=t?t.intensity:0,r=t?t.angle:0,i=t?t.alpha:0;return o.a.createElement(C.a,null,o.a.createElement(D.a,null," Separation intensity "),o.a.createElement(P.a,{min:0,max:.15,value:a,step:.005,onChange:function(e,a){return n(H({},t,{intensity:a}))}}),o.a.createElement(D.a,null," Image intensity "),o.a.createElement(P.a,{min:0,max:1,value:i,step:.05,onChange:function(e,a){return n(H({},t,{alpha:a}))}}),o.a.createElement(D.a,null," Angle "),o.a.createElement(P.a,{min:0,max:2*Math.PI,value:r,step:.01,marks:z,onChange:function(e,a){return n(H({},t,{angle:a}))}}))}}],selected:{id:r.no,extraData:{angle:0,intensity:.1,alpha:.5}},effect:function(e,t,n){var a=t.id,i=t.extraData,o=n.original;if(a!==r.no){var c=i&&i.angle||0,l=i&&i.intensity||0,s=i&&i.alpha||0,u=e.canvas,f=Math.min(u.width,u.height)*l,h=Math.floor(Math.sin(c)*f),g=Math.floor(Math.cos(c)*f);e.globalAlpha=s,e.drawImage(o,0,0,o.width,o.height,h,g,u.width,u.height),e.globalAlpha=1}}}],V=n(22),W=n.n(V),J=n(35),Z=n(33),G=n(49),Q=n.n(G);function $(e){return K.apply(this,arguments)}function K(){return(K=Object(J.a)(W.a.mark(function e(t){return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.complete){e.next=2;break}return e.abrupt("return");case 2:if(!t.decode){e.next=6;break}return e.next=5,t.decode();case 5:return e.abrupt("return",e.sent);case 6:return e.next=8,new Promise(function(e,n){t.addEventListener("load",e),t.addEventListener("error",n)});case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}))).apply(this,arguments)}function X(){return(X=Object(J.a)(W.a.mark(function e(t,n){var a,r,i,o,c,l,s;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.current){e.next=3;break}return console.warn("we don't have a canvas yet!"),e.abrupt("return");case 3:if(a=n.current,a.getContext("2d")){e.next=8;break}return console.warn("we don't have a ctx yet!"),e.abrupt("return");case 8:return console.log("rendering canvas",new Date),e.next=11,$(t);case 11:r=t.width,i=t.height,o=r/i,a.height=a.width/o,c=a.width,l=a.height,s=c/r,a.style.width=c+"px",a.style.height=l+"px",a.width/=s,a.height/=s;case 22:case"end":return e.stop()}},e)}))).apply(this,arguments)}var Y=Q()();function ee(e,t,n,a){return te.apply(this,arguments)}function te(){return(te=Object(J.a)(W.a.mark(function e(t,n,a,r){var i,o,c,l,s,u,f,h,g;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=Q()(),Y=i,a.current){e.next=5;break}return console.warn("we don't have a canvas yet!"),e.abrupt("return");case 5:if(o=a.current,c=o.getContext("2d")){e.next=10;break}return console.warn("we don't have a ctx yet!"),e.abrupt("return");case 10:if(l=t.width,s=t.height,console.log("rendering canvas",new Date),c.clearRect(0,0,o.width,o.height),c.fillStyle="white",c.fillRect(0,0,o.width,o.height),c.imageSmoothingEnabled=!1,c.drawImage(t,0,0,l,s,0,0,o.width,o.height),r){e.next=37;break}u=Object.keys(n).map(function(e){return n[e]}),f=0;case 21:if(!(f<u.length)){e.next=37;break}return h=u[f],e.next=25,new Promise(function(e){return requestAnimationFrame(e)});case 25:if(Y!==i){e.next=32;break}g="canvas-".concat(h.question.id),console.time(g),h.effect(c,h.selected,{original:t}),console.timeEnd(g),e.next=34;break;case 32:return console.log("break render",i,Y),e.abrupt("break",37);case 34:f++,e.next=21;break;case 37:case"end":return e.stop()}},e)}))).apply(this,arguments)}var ne,ae,re,ie=Object(Z.a)(function(e,t){var n=e.currentImage;t||(t=Object(i.useRef)(null));var a=Object(i.useContext)(le),r=a.questions;return a.registeredCanvas=t,a.registeredImage=n,Object(i.useEffect)(function(){!function(e){var t=e.current;t&&(t.width=t.offsetWidth,t.height=t.offsetHeight)}(t),function(e,t){return X.apply(this,arguments)}(n,t).then(function(){return ee(n,r,t,a.showOriginal)})}),o.a.createElement("div",{className:"full-width full-height",style:{display:"flex"}},o.a.createElement("canvas",{ref:t,className:"full-height",style:{margin:"0 auto"}}))},{forwardRef:!0});function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}var ce=(ne=function(){function e(){Object(E.a)(this,e),Object(y.a)(this,"questions",ae,this),Object(y.a)(this,"showOriginal",re,this),this.registeredCanvas=null,this.registeredImage=null}return Object(j.a)(e,[{key:"setShowOriginal",value:function(e){this.showOriginal=e,this._renderCanvas()}},{key:"setAnswer",value:function(e,t,n){var a=this.questions[e];console.log("setting answer to",Object(k.h)(a),"to",t),a.selected={id:t},n&&(a.selected.extraData=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(n,!0).forEach(function(t){Object(O.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},a.selected.extraData||{},{},n)),this._renderCanvas()}},{key:"setAnswerExtraData",value:function(e,t){this.questions[e].selected.extraData=t,this._renderCanvas()}},{key:"_renderCanvas",value:function(){var e=this;requestAnimationFrame(function(){e.registeredImage&&e.registeredCanvas&&ee(e.registeredImage,e.questions,e.registeredCanvas,e.showOriginal)})}}]),e}(),ae=Object(x.a)(ne.prototype,"questions",[k.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return T.reduce(function(e,t){return e[t.question.id]=t,e},{})}}),re=Object(x.a)(ne.prototype,"showOriginal",[k.e],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Object(x.a)(ne.prototype,"setShowOriginal",[k.b],Object.getOwnPropertyDescriptor(ne.prototype,"setShowOriginal"),ne.prototype),Object(x.a)(ne.prototype,"setAnswer",[k.b],Object.getOwnPropertyDescriptor(ne.prototype,"setAnswer"),ne.prototype),Object(x.a)(ne.prototype,"setAnswerExtraData",[k.b],Object.getOwnPropertyDescriptor(ne.prototype,"setAnswerExtraData"),ne.prototype),ne),le=Object(i.createContext)(new ce),se=(n(99),n(67)),ue=n.n(se),fe=n(132),he=Object(f.a)(function(e){return{gridList:{backgroundColor:e.palette.background.default,padding:"16px"}}}),ge=Object(Z.a)(function(e){var t=e.q_id,n=Object(i.useContext)(le),a=n.questions[t].question.string,r=n.questions[t].answers,c=n.questions[t].selected,l=Object(i.useState)(!1),s=Object(g.a)(l,2),u=s[0],f=s[1];return o.a.createElement(m.a,{className:"question",elevation:2},o.a.createElement(m.a,{onClick:function(){return f(!u)},elevation:1,className:"header"},o.a.createElement(ue.a,{fontSize:"inherit",height:"30px"}),o.a.createElement("span",null,a)),o.a.createElement(p.a,{in:u},o.a.createElement(fe.a,{className:"content full-width"},o.a.createElement(d.a,{onChange:function(e){return n.setAnswer(t,e.target.value)},value:c&&c.id},r.map(function(e,a){var r=c&&c.id===e.id&&e.extraComponent?o.a.createElement(e.extraComponent,{extraData:c.extraData,setExtraData:function(e){return n.setAnswerExtraData(t,e)}}):null;return o.a.createElement("div",{key:a,className:"full-width"},o.a.createElement(b.a,{className:"full-width",key:e.id.toString(),value:e.id.toString(),control:o.a.createElement(v.a,null),label:e.string}),r)})))))}),me=function(){var e=he();return o.a.createElement(w.a,{cols:1,className:e.gridList,cellHeight:"auto",style:{margin:0}},T.map(function(e,t){return o.a.createElement(ge,{key:t,q_id:e.question.id})}))},pe=n(68),de=n.n(pe),be=n(128),ve=n(125),we=n(69),Oe=n.n(we),ye=n(70),Ee=n.n(ye),je=n(71),xe=n.n(je),ke=n(72),Ce=n.n(ke),De=n(73),Pe=n.n(De),Se=n(74),Ie=n.n(Se),Ae=n(75),qe=n.n(Ae),Me=Object(f.a)(function(e){return{fsItem:{background:e.palette.background.default,position:"relative"},actionButton:{fontSize:"48px",position:"absolute",zIndex:1},left:{left:0},right:{right:0},bottom:{bottom:0},zoomArea:{zIndex:0,width:"100%"},screenHeight:{height:"100vh"},center:{margin:"0 auto",alignSelf:"center"},crossedOutMark:{transform:"rotate(45deg) scale(1.5)"}}}),Ne=function(e){var t=new Image;return t.src=e,t},Be=function(){var e=Object(J.a)(W.a.mark(function e(t){var n,a;return W.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Image,e.next=3,new Promise(function(e,n){var a=new FileReader;a.onload=function(){return e(a.result)},a.onerror=n,a.readAsDataURL(t)});case 3:return a=e.sent,n.src=a,e.abrupt("return",n);case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),Re=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,n=e.width/e.height,a=e.width,r=e.height;a>t&&(r=(a=t)/n),r>t&&(a=(r=t)*n);var i=document.createElement("canvas");i.width=a,i.height=r;var o=i.getContext("2d");if(!o)return e;o.drawImage(e,0,0,e.width,e.height,0,0,a,r);var c=new Image(a,r);return c.src=i.toDataURL("image/png"),c},Le={angles:Ne(de.a),panel:Ne(Ee.a)},ze=Object(Z.a)(function(){var e=Me(),t=Object(i.useContext)(le);Object(i.useEffect)(function(){var e=function(){s(!1),m(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",e),function(){document.removeEventListener("fullscreenchange",e)}},[]);var n=Object(i.useRef)(null),a=(Object(i.useRef)(null),Object(i.useRef)(null)),r=Object(i.useState)(!1),c=Object(g.a)(r,2),l=c[0],s=c[1],u=Object(i.useState)(!1),f=Object(g.a)(u,2),h=f[0],m=f[1],d=Object(i.useState)(0),b=Object(g.a)(d,2),v=b[0],w=b[1],O=Object(i.useState)(Le.angles),y=Object(g.a)(O,2),E=y[0],j=y[1];return o.a.createElement("div",{ref:n,className:e.fsItem},h?null:o.a.createElement(M.a,{onClick:function(){return s(!l)},className:[e.actionButton,e.left].join(" "),style:{transform:l?"":"rotate(180deg)",transition:"transform .3s ease-out"}}),h?o.a.createElement(Ce.a,{className:[e.actionButton,e.right].join(" "),onClick:function(){return document.exitFullscreen().then(function(){return m(!1)})}}):o.a.createElement(xe.a,{className:[e.actionButton,e.right].join(" "),onClick:function(){return n.current&&n.current.requestFullscreen({navigationUI:"hide"}).then(function(){return m(!0)})}}),o.a.createElement(Pe.a,{className:[e.actionButton,e.right,e.bottom].join(" "),onClick:function(){return!t.showOriginal&&function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image.png";if(e&&e.current){var n=e.current.toDataURL("image/png").substr("data:image/png;base64,".length),a=atob(n);console.log(n);for(var r=new ArrayBuffer(a.length),i=new Uint8Array(r),o=0;o<a.length;o+=1)i[o]=a.charCodeAt(o);var c=new Blob([i],{type:"image/png"}),l=URL.createObjectURL(c),s=document.createElement("a");s.download=t,s.href=l,s.click()}}(t.registeredCanvas)},opacity:t.showOriginal?.5:1}),o.a.createElement(Ie.a,{className:[e.actionButton,e.bottom,e.left].join(" "),onClick:function(){return t.setShowOriginal(!0)}}),t.showOriginal?o.a.createElement(qe.a,{className:[e.actionButton,e.bottom,e.left,e.crossedOutMark].join(" "),onClick:function(){return t.setShowOriginal(!1)}}):null,o.a.createElement(p.a,{in:!l,collapsedHeight:"120px"},o.a.createElement(be.a,{value:v,onChange:function(e,t){return w(t)},centered:!0},o.a.createElement(ve.a,{label:"Angles",onClick:function(){return j(Le.angles)}}),o.a.createElement(ve.a,{label:"Panel",onClick:function(){return j(Le.panel)}}),o.a.createElement(ve.a,{label:"Image",onClick:function(){a.current&&a.current.click()}})),o.a.createElement("input",{hidden:!0,ref:a,type:"file",accept:"image/*",onChange:function(e){return e.target&&e.target.files&&e.target.files[0]&&Be(e.target.files[0]).then(Re).then(function(e){j(e),a.current&&(a.current.value="")})}}),o.a.createElement(Oe.a,{debug:!1,className:[e.zoomArea,h?e.screenHeight:""].join(" "),minZoomScale:.9,maxZoomScale:10,boundSize:{height:0,width:0},contentSize:{height:0,width:0}},o.a.createElement(ie,{currentImage:E}))))}),Ue=Object(f.a)(function(e){return{main:{background:e.palette.background.default}}}),Fe=function(){var e=Ue();return o.a.createElement("div",{className:"full-height full-width ".concat(e.main),style:{display:"flex",flexFlow:"column"}},o.a.createElement("div",{style:{flexGrow:1}},o.a.createElement(me,null)),o.a.createElement(h.a,null),o.a.createElement(ze,null))};var _e=function(){return o.a.createElement(s.a,{basename:"/cumvad.eu"},o.a.createElement(u.a,{exact:!0,path:"/",component:Fe}),o.a.createElement(u.a,{path:"/about",component:function(){return o.a.createElement("strong",null,"About")}}),o.a.createElement(u.a,{path:"/topics",component:function(){return o.a.createElement("strong",null,"Topics")}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(o.a.createElement(_e,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},68:function(e,t,n){e.exports=n.p+"static/media/angles.062caee1.png"},70:function(e,t,n){e.exports=n.p+"static/media/panel.c5657b9f.png"},83:function(e,t,n){e.exports=n(103)},88:function(e,t,n){},89:function(e,t,n){},99:function(e,t,n){}},[[83,1,2]]]);
//# sourceMappingURL=main.38c8a400.chunk.js.map